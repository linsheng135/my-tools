<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ä¸ªäººå¯¼èˆªé¡µ | ä¸“ä¸šé«˜æ•ˆçš„é“¾æ¥ç®¡ç†å™¨</title>
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”—</text></svg>">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-color: #6366f1;
      --secondary-color: #8b5cf6;
      --background-color: #f8fafc;
      --card-color: #ffffff;
      --text-color: #1e293b;
      --text-secondary: #64748b;
      --border-color: #e2e8f0;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --export-color: #0ea5e9;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 12px;
    }

    .dark-mode {
      --primary-color: #818cf8;
      --secondary-color: #a78bfa;
      --background-color: #0f172a;
      --card-color: #1e293b;
      --text-color: #f1f5f9;
      --text-secondary: #94a3b8;
      --border-color: #334155;
      --export-color: #38bdf8;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--background-color);
      color: var(--text-color);
      min-height: 100vh;
      padding: 0;
      line-height: 1.5;
      transition: background-color 0.3s ease;
      overflow-x: hidden;
    }

    body.dark-mode {
      background: var(--background-color);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
      flex-wrap: wrap;
      gap: 15px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
    }

    .logo i {
      font-size: 28px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 18px;
      border-radius: var(--radius);
      border: none;
      background: var(--primary-color);
      color: white;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      font-size: 15px;
    }

    .btn:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .btn-secondary {
      background: var(--card-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: #f1f5f9;
      border-color: var(--primary-color);
    }

    body.dark-mode .btn-secondary:hover {
      background: #334155;
    }

    .btn-export {
      background: var(--export-color);
      color: white;
    }

    .btn-export:hover {
      background: #0284c7;
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .btn-danger {
      background: var(--danger-color);
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-2px);
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 14px;
    }

    /* é¢åŒ…å±‘å¯¼èˆª */
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      padding: 12px 16px;
      background: var(--card-color);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
    }

    .breadcrumb-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: color 0.3s ease;
      font-size: 14px;
    }

    .breadcrumb-item:hover {
      color: var(--primary-color);
    }

    .breadcrumb-item.active {
      color: var(--text-color);
      font-weight: 500;
      cursor: default;
    }

    .breadcrumb-separator {
      color: var(--text-secondary);
    }

    /* å†…å®¹ç½‘æ ¼ */
    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    @media (max-width: 768px) {
      .content-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }
    }

    @media (max-width: 480px) {
      .content-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
    }

    /* æ–‡ä»¶å¤¹å¡ç‰‡ */
    .folder-card {
      background: var(--card-color);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
      position: relative;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      min-height: 160px;
    }

    .folder-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      border-color: var(--primary-color);
    }

    .folder-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
      flex: 1;
    }

    .folder-info {
      display: flex;
      align-items: center;
      gap: 15px;
      flex: 1;
      min-width: 0;
    }

    .folder-icon {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: linear-gradient(135deg, #a5b4fc 0%, #818cf8 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      flex-shrink: 0;
    }

    .folder-text {
      min-width: 0;
      flex: 1;
    }

    .folder-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .folder-desc {
      color: var(--text-secondary);
      font-size: 13px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      line-height: 1.4;
      max-height: 2.8em;
    }

    .folder-stats {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: auto;
      font-size: 12px;
      color: var(--text-secondary);
      padding-top: 12px;
      border-top: 1px solid var(--border-color);
    }

    .folder-actions {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }

    /* é“¾æ¥é¡µé¢ */
    .links-container {
      background: var(--card-color);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
      margin-bottom: 30px;
    }

    .links-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .links-header h2 {
      font-size: 22px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .links-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 15px;
    }

    @media (max-width: 768px) {
      .links-list {
        grid-template-columns: 1fr;
      }
    }

    .link-card {
      background: var(--background-color);
      border-radius: var(--radius);
      padding: 16px;
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .link-card:hover {
      background: var(--card-color);
      border-color: var(--primary-color);
      transform: translateY(-3px);
      box-shadow: var(--shadow);
    }

    .link-header {
      display: flex;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .link-icon-container {
      width: 44px;
      height: 44px;
      border-radius: 8px;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      font-size: 16px;
      color: var(--primary-color);
      border: 1px solid var(--border-color);
      overflow: hidden;
      flex-shrink: 0;
    }

    .link-icon-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .link-title-container {
      flex: 1;
      min-width: 0;
    }

    .link-title {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .link-url {
      font-size: 12px;
      color: var(--text-secondary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-bottom: 6px;
    }

    .link-notes {
      font-size: 13px;
      color: var(--text-color);
      line-height: 1.5;
      margin-top: 10px;
      padding: 10px;
      background: rgba(99, 102, 241, 0.05);
      border-radius: 6px;
      border-left: 3px solid var(--primary-color);
    }

    .link-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      justify-content: flex-end;
    }

    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
    }

    .empty-state i {
      font-size: 48px;
      margin-bottom: 15px;
      color: #cbd5e1;
    }

    .empty-state h3 {
      font-size: 20px;
      margin-bottom: 10px;
      color: var(--text-color);
    }

    /* æ¨¡æ€æ¡† */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      padding: 20px;
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--card-color);
      border-radius: var(--radius);
      padding: 24px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transform: translateY(20px);
      transition: all 0.3s ease;
    }

    .modal.active .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .modal-close:hover {
      color: var(--danger-color);
    }

    .form-group {
      margin-bottom: 18px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
    }

    .form-input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--card-color);
      color: var(--text-color);
      font-size: 15px;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .form-textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--card-color);
      color: var(--text-color);
      font-size: 15px;
      transition: all 0.3s ease;
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    .form-textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 25px;
    }

    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--card-color);
      border-radius: var(--radius);
      padding: 14px 18px;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 100;
      max-width: 90vw;
    }

    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    .notification.success {
      border-left: 4px solid var(--success-color);
    }

    .notification.error {
      border-left: 4px solid var(--danger-color);
    }

    .notification.warning {
      border-left: 4px solid var(--warning-color);
    }

    .sync-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 20px;
      background: rgba(99, 102, 241, 0.1);
      color: var(--primary-color);
    }

    .theme-toggle {
      background: var(--card-color);
      border: 1px solid var(--border-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      transform: rotate(30deg);
    }

    .confirm-modal .modal-content {
      max-width: 400px;
    }

    .confirm-text {
      margin-bottom: 18px;
      line-height: 1.6;
    }

    .confirm-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 25px;
    }

    /* ç»Ÿè®¡æ•°æ®æ ·å¼ */
    .stats-footer {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 25px;
      padding-top: 25px;
      border-top: 1px solid var(--border-color);
    }

    .stat-item {
      text-align: center;
      padding: 12px;
      background: var(--card-color);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .footer {
      text-align: center;
      padding: 25px 0 15px;
      color: var(--text-secondary);
      font-size: 14px;
      margin-top: 20px;
    }

    /* è¿”å›æŒ‰é’® */
    .back-btn {
      background: var(--card-color);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 10px 16px;
      color: var(--text-color);
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      margin-bottom: 15px;
      width: 100%;
      justify-content: center;
    }

    .back-btn:hover {
      background: #f1f5f9;
      border-color: var(--primary-color);
    }

    body.dark-mode .back-btn:hover {
      background: #334155;
    }

    /* æœç´¢æ¡† */
    .search-container {
      margin-bottom: 20px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 14px 18px;
      padding-left: 50px;
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      background: var(--card-color);
      color: var(--text-color);
      font-size: 15px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .search-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 16px;
    }

    /* å¿«é€Ÿæ“ä½œæ  */
    .quick-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .header-actions {
        width: 100%;
        justify-content: space-between;
      }

      .btn {
        padding: 8px 14px;
        font-size: 14px;
      }

      .folder-card {
        padding: 16px;
        min-height: 150px;
      }

      .folder-icon {
        width: 40px;
        height: 40px;
        font-size: 16px;
      }

      .folder-title {
        font-size: 15px;
      }

      .folder-desc {
        font-size: 12px;
      }

      .links-container {
        padding: 16px;
      }

      .links-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .links-header h2 {
        font-size: 20px;
      }

      .stats-footer {
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }

      .stat-item {
        padding: 10px;
      }

      .stat-value {
        font-size: 20px;
      }

      .modal-content {
        padding: 20px;
      }
    }

    @media (max-width: 480px) {
      .content-grid {
        gap: 10px;
      }

      .folder-card {
        padding: 14px;
        min-height: 140px;
      }

      .folder-icon {
        width: 36px;
        height: 36px;
        font-size: 14px;
      }

      .header-actions {
        gap: 8px;
      }

      .btn {
        padding: 8px 12px;
        font-size: 13px;
      }

      .stats-footer {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }

      .stat-item {
        padding: 8px;
      }

      .stat-value {
        font-size: 18px;
      }

      .footer {
        padding: 20px 0 10px;
        font-size: 12px;
      }
    }

    /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
    @media (hover: none) and (pointer: coarse) {
      .folder-card:hover {
        transform: none;
      }

      .link-card:hover {
        transform: none;
      }

      .btn:hover {
        transform: none;
      }

      .folder-card:active {
        transform: scale(0.98);
      }

      .link-card:active {
        transform: scale(0.98);
      }

      .btn:active {
        transform: scale(0.98);
      }
    }

    /* å¯¼å‡ºé€‰é¡¹æ ·å¼ */
    .export-options {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .export-section {
      margin-bottom: 30px;
    }

    .export-section h3 {
      margin-bottom: 15px;
      color: var(--text-color);
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="header">
      <div class="logo">
        <i class="fas fa-compass"></i>
        <span>ä¸ªäººå¯¼èˆª</span>
      </div>
      <div class="header-actions">
        <button class="btn" id="addFolderBtn">
          <i class="fas fa-folder-plus"></i>
          <span class="desktop-only">æ–°å»ºæ–‡ä»¶å¤¹</span>
        </button>
        <button class="btn" id="addLinkBtn">
          <i class="fas fa-plus"></i>
          <span class="desktop-only">æ·»åŠ é“¾æ¥</span>
        </button>
        <button class="btn btn-export" id="exportAllBtn">
          <i class="fas fa-file-export"></i>
          <span class="desktop-only">å¯¼å‡ºæ‰€æœ‰é“¾æ¥</span>
        </button>
        <div class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon" id="themeIcon"></i>
        </div>
        <button class="btn btn-secondary" id="settingsBtn">
          <i class="fas fa-cog"></i>
        </button>
      </div>
    </header>

    <!-- æœç´¢æ¡† -->
    <div class="search-container">
      <i class="fas fa-search search-icon"></i>
      <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢æ–‡ä»¶å¤¹æˆ–é“¾æ¥...">
    </div>

    <!-- å¿«é€Ÿæ“ä½œæ  -->
    <div class="quick-actions" id="quickActions">
      <!-- æ“ä½œæŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
    </div>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb" id="breadcrumb">
      <div class="breadcrumb-item active" data-id="">æ ¹ç›®å½•</div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ - æ–‡ä»¶å¤¹è§†å›¾ -->
    <div class="content-grid" id="contentGrid">
      <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
    </div>

    <!-- é“¾æ¥åˆ—è¡¨åŒºåŸŸ - æ–‡ä»¶å¤¹è¯¦æƒ…é¡µ -->
    <div class="links-container" id="linksContainer" style="display: none;">
      <div class="links-header">
        <h2 id="currentFolderTitle">
          <i class="fas fa-folder" id="currentFolderIcon"></i>
          <span id="currentFolderName">æ–‡ä»¶å¤¹åç§°</span>
        </h2>
        <div class="links-header-actions">
          <button class="btn btn-secondary" id="addLinkToCurrentBtn">
            <i class="fas fa-plus"></i>
            <span class="desktop-only">æ·»åŠ é“¾æ¥</span>
          </button>
          <button class="btn" id="addSubfolderBtn">
            <i class="fas fa-folder-plus"></i>
            <span class="desktop-only">å­æ–‡ä»¶å¤¹</span>
          </button>
        </div>
      </div>
      <div class="links-list" id="linksList">
        <!-- é“¾æ¥å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
      </div>
    </div>

    <!-- è¿”å›æŒ‰é’®ï¼ˆåœ¨æ–‡ä»¶å¤¹è¯¦æƒ…é¡µæ˜¾ç¤ºï¼‰ -->
    <button class="back-btn" id="backBtn" style="display: none;">
      <i class="fas fa-arrow-left"></i> è¿”å›ä¸Šçº§
    </button>

    <!-- ç»Ÿè®¡æ•°æ®åº•éƒ¨ -->
    <div class="stats-footer" id="statsFooter">
      <div class="stat-item">
        <div class="stat-value" id="folderCount">0</div>
        <div class="stat-label">æ–‡ä»¶å¤¹</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="linkCount">0</div>
        <div class="stat-label">é“¾æ¥</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="subfolderCount">0</div>
        <div class="stat-label">å­æ–‡ä»¶å¤¹</div>
      </div>
    </div>

    <!-- åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="sync-status" id="syncStatus" style="display: none;">
      <i class="fas fa-sync-alt fa-spin"></i>
      <span id="syncStatusText">æ­£åœ¨åŒæ­¥...</span>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
      <p>ä¸ªäººå¯¼èˆªé¡µ &copy; 2024 | æ•°æ®å­˜å‚¨äºæ‚¨çš„æµè§ˆå™¨å’ŒGitHub Gist</p>
      <p style="margin-top: 10px; font-size: 13px;">
        æœ€ååŒæ­¥æ—¶é—´: <span id="lastSyncTime">ä»æœªåŒæ­¥</span>
        <button class="btn btn-small" id="manualSyncBtn"
          style="margin-left: 10px; padding: 4px 10px;">
          <i class="fas fa-sync-alt"></i> æ‰‹åŠ¨åŒæ­¥
        </button>
      </p>
    </footer>
  </div>

  <!-- æ¨¡æ€æ¡†ï¼šæ·»åŠ /ç¼–è¾‘æ–‡ä»¶å¤¹ -->
  <div class="modal" id="folderModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="folderModalTitle">æ–°å»ºæ–‡ä»¶å¤¹</h3>
        <button class="modal-close" id="folderModalClose">&times;</button>
      </div>
      <form id="folderForm">
        <div class="form-group">
          <label class="form-label" for="folderName">æ–‡ä»¶å¤¹åç§° *</label>
          <input type="text" class="form-input" id="folderName" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="folderDescription">æè¿° (å¯é€‰)</label>
          <input type="text" class="form-input" id="folderDescription" placeholder="ä¾‹å¦‚ï¼šå·¥ä½œç›¸å…³çš„é“¾æ¥">
        </div>
        <div class="form-group">
          <label class="form-label" for="parentFolder">çˆ¶æ–‡ä»¶å¤¹</label>
          <select class="form-input" id="parentFolder">
            <option value="">æ—  (æ ¹ç›®å½•)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="folderIcon">å›¾æ ‡</label>
          <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 10px;">
            <div class="folder-icon-option selected" data-icon="folder">
              <i class="fas fa-folder"></i>
            </div>
            <div class="folder-icon-option" data-icon="briefcase">
              <i class="fas fa-briefcase"></i>
            </div>
            <div class="folder-icon-option" data-icon="code">
              <i class="fas fa-code"></i>
            </div>
            <div class="folder-icon-option" data-icon="heart">
              <i class="fas fa-heart"></i>
            </div>
            <div class="folder-icon-option" data-icon="gamepad">
              <i class="fas fa-gamepad"></i>
            </div>
            <div class="folder-icon-option" data-icon="music">
              <i class="fas fa-music"></i>
            </div>
            <div class="folder-icon-option" data-icon="star">
              <i class="fas fa-star"></i>
            </div>
            <div class="folder-icon-option" data-icon="book">
              <i class="fas fa-book"></i>
            </div>
          </div>
          <input type="hidden" id="folderIcon" value="folder">
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="folderCancelBtn">å–æ¶ˆ</button>
          <button type="submit" class="btn" id="folderSubmitBtn">ä¿å­˜</button>
        </div>
      </form>
    </div>
  </div>

  <!-- æ¨¡æ€æ¡†ï¼šæ·»åŠ /ç¼–è¾‘é“¾æ¥ -->
  <div class="modal" id="linkModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="linkModalTitle">æ·»åŠ é“¾æ¥</h3>
        <button class="modal-close" id="linkModalClose">&times;</button>
      </div>
      <form id="linkForm">
        <div class="form-group">
          <label class="form-label" for="linkName">é“¾æ¥åç§° *</label>
          <input type="text" class="form-input" id="linkName" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="linkUrl">URL *</label>
          <input type="url" class="form-input" id="linkUrl" placeholder="https://example.com" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="linkFolder">æ‰€å±æ–‡ä»¶å¤¹</label>
          <select class="form-input" id="linkFolder">
            <option value="">æ—  (æ˜¾ç¤ºåœ¨æ ¹ç›®å½•)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="linkNotes">å¤‡æ³¨ (å¯é€‰)</label>
          <textarea class="form-textarea" id="linkNotes"
            placeholder="è¿™ä¸ªç½‘ç«™çš„ä¸»è¦åŠŸèƒ½ã€ç”¨é€”ã€æ³¨æ„äº‹é¡¹ç­‰..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">å›¾æ ‡</label>
          <div style="display: flex; align-items: center; gap: 15px;">
            <div class="link-icon-container" id="linkIconPreview" style="margin: 0;">
              <i class="fas fa-link"></i>
            </div>
            <div>
              <p style="font-size: 14px; color: var(--text-secondary);">å°†è‡ªåŠ¨ä»ç½‘ç«™è·å–å›¾æ ‡</p>
            </div>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="linkCancelBtn">å–æ¶ˆ</button>
          <button type="submit" class="btn" id="linkSubmitBtn">ä¿å­˜</button>
        </div>
      </form>
    </div>
  </div>

  <!-- æ¨¡æ€æ¡†ï¼šå¯¼å‡ºæ‰€æœ‰é“¾æ¥ -->
  <div class="modal" id="exportModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-file-export"></i> å¯¼å‡ºæ‰€æœ‰é“¾æ¥</h3>
        <button class="modal-close" id="exportModalClose">&times;</button>
      </div>
      
      <div class="export-section">
        <h3><i class="fas fa-file-html"></i> å¯¼å‡ºä¸ºHTMLæ–‡ä»¶</h3>
        <p style="margin-bottom: 15px; color: var(--text-secondary);">
          å¯¼å‡ºä¸€ä¸ªå®Œæ•´çš„HTMLæ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰é“¾æ¥å’Œæ–‡ä»¶å¤¹ç»“æ„ã€‚å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä½¿ç”¨ã€‚
        </p>
        <button class="btn btn-export" id="exportHtmlBtn" style="width: 100%;">
          <i class="fas fa-download"></i> å¯¼å‡ºHTMLæ–‡ä»¶
        </button>
      </div>

      <div class="export-section">
        <h3><i class="fas fa-file-code"></i> å¯¼å‡ºä¸ºJSONæ–‡ä»¶</h3>
        <p style="margin-bottom: 15px; color: var(--text-secondary);">
          å¯¼å‡ºåŸå§‹æ•°æ®æ–‡ä»¶ï¼Œå¯ç”¨äºå¤‡ä»½æˆ–å¯¼å…¥åˆ°å…¶ä»–æ”¯æŒJSONçš„åº”ç”¨ã€‚
        </p>
        <button class="btn btn-secondary" id="exportJsonBtn" style="width: 100%;">
          <i class="fas fa-download"></i> å¯¼å‡ºJSONæ–‡ä»¶
        </button>
      </div>

      <div class="export-section">
        <h3><i class="fas fa-file-alt"></i> å¯¼å‡ºä¸ºçº¯æ–‡æœ¬</h3>
        <p style="margin-bottom: 15px; color: var(--text-secondary);">
          å¯¼å‡ºä¸ºç®€å•çš„æ–‡æœ¬æ ¼å¼ï¼Œä¾¿äºå¤åˆ¶ç²˜è´´åˆ°å…¶ä»–åº”ç”¨ã€‚
        </p>
        <button class="btn btn-secondary" id="exportTextBtn" style="width: 100%;">
          <i class="fas fa-copy"></i> å¤åˆ¶åˆ°å‰ªè´´æ¿
        </button>
      </div>

      <div class="export-section">
        <h3><i class="fas fa-file-csv"></i> å¯¼å‡ºä¸ºCSVæ–‡ä»¶</h3>
        <p style="margin-bottom: 15px; color: var(--text-secondary);">
          å¯¼å‡ºä¸ºè¡¨æ ¼æ ¼å¼ï¼Œå¯ä»¥ç”¨Excelæˆ–å…¶ä»–ç”µå­è¡¨æ ¼è½¯ä»¶æ‰“å¼€ã€‚
        </p>
        <button class="btn btn-secondary" id="exportCsvBtn" style="width: 100%;">
          <i class="fas fa-download"></i> å¯¼å‡ºCSVæ–‡ä»¶
        </button>
      </div>

      <div class="form-actions" style="margin-top: 30px;">
        <button type="button" class="btn btn-secondary" id="exportCancelBtn">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <!-- æ¨¡æ€æ¡†ï¼šè®¾ç½® -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">è®¾ç½®</h3>
        <button class="modal-close" id="settingsModalClose">&times;</button>
      </div>
      <div style="margin-bottom: 30px;">
        <h4 style="margin-bottom: 15px; font-size: 18px;">GitHubåŒæ­¥</h4>
        <div class="form-group">
          <label class="form-label" for="githubToken">GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ</label>
          <div style="display: flex; gap: 10px;">
            <input type="password" class="form-input" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
              style="flex: 1;">
            <button type="button" class="btn btn-secondary" id="toggleTokenVisibility">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
            éœ€è¦ <strong>gist</strong> æƒé™ã€‚å·²é…ç½®: <span id="tokenStatus">æœªé…ç½®</span>
          </p>
        </div>
        <div class="form-group">
          <label class="form-label" for="gistId">Gist ID</label>
          <input type="text" class="form-input" id="gistId" placeholder="ç•™ç©ºå°†è‡ªåŠ¨åˆ›å»º">
          <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
            å½“å‰Gist ID: <span id="currentGistId">æœªè®¾ç½®</span>
          </p>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button class="btn" id="saveSettingsBtn" style="flex: 1;">
            <i class="fas fa-save"></i> ä¿å­˜è®¾ç½®
          </button>
          <button class="btn btn-secondary" id="testSyncBtn" style="flex: 1;">
            <i class="fas fa-sync-alt"></i> æµ‹è¯•åŒæ­¥
          </button>
        </div>
      </div>
      <div style="margin-bottom: 30px;">
        <h4 style="margin-bottom: 15px; font-size: 18px;">æ•°æ®ç®¡ç†</h4>
        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          <button class="btn btn-secondary" id="exportDataBtn" style="flex: 1;">
            <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®(JSON)
          </button>
          <button class="btn btn-export" id="openExportModalBtn" style="flex: 1;">
            <i class="fas fa-file-export"></i> å¯¼å‡ºæ‰€æœ‰é“¾æ¥
          </button>
          <button class="btn btn-secondary" id="importDataBtn" style="flex: 1;">
            <i class="fas fa-upload"></i> å¯¼å…¥æ•°æ®
          </button>
        </div>
        <input type="file" id="importFileInput" accept=".json" style="display: none;">
        <div style="margin-top: 15px;">
          <button class="btn btn-danger" id="clearDataBtn" style="width: 100%;">
            <i class="fas fa-trash"></i> æ¸…ç©ºæ‰€æœ‰æ•°æ®
          </button>
        </div>
      </div>
      <div style="margin-bottom: 30px;">
        <h4 style="margin-bottom: 15px; font-size: 18px;">å¤–è§‚è®¾ç½®</h4>
        <div style="display: flex; align-items: center; gap: 15px;">
          <span>ä¸»é¢˜:</span>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-secondary theme-selector active" data-theme="light">
              <i class="fas fa-sun"></i> æµ…è‰²
            </button>
            <button class="btn btn-secondary theme-selector" data-theme="dark">
              <i class="fas fa-moon"></i> æ·±è‰²
            </button>
            <button class="btn btn-secondary theme-selector" data-theme="auto">
              <i class="fas fa-adjust"></i> è‡ªåŠ¨
            </button>
          </div>
        </div>
      </div>
      <div>
        <h4 style="margin-bottom: 15px; font-size: 18px;">å…³äº</h4>
        <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
          ä¸ªäººå¯¼èˆªé¡µ v2.1 | æ”¯æŒæ–‡ä»¶å¤¹åµŒå¥—ã€é“¾æ¥å¤‡æ³¨ã€ç§»åŠ¨ç«¯ä¼˜åŒ–ã€å¤šç§æ ¼å¼å¯¼å‡º
        </p>
      </div>
    </div>
  </div>

  <!-- ç¡®è®¤æ¨¡æ€æ¡† -->
  <div class="modal confirm-modal" id="confirmModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="confirmTitle">ç¡®è®¤æ“ä½œ</h3>
        <button class="modal-close" id="confirmModalClose">&times;</button>
      </div>
      <div class="confirm-text" id="confirmText">
        æ‚¨ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ
      </div>
      <div class="confirm-actions">
        <button class="btn btn-secondary" id="confirmCancelBtn">å–æ¶ˆ</button>
        <button class="btn" id="confirmActionBtn">ç¡®è®¤</button>
      </div>
    </div>
  </div>

  <!-- é€šçŸ¥æ¶ˆæ¯ -->
  <div class="notification" id="notification"></div>

  <script>
    // ä¸»åº”ç”¨ä»£ç 
    document.addEventListener('DOMContentLoaded', function () {
      // åº”ç”¨çŠ¶æ€
      const appState = {
        folders: [],
        links: [],
        editingFolderId: null,
        editingLinkId: null,
        currentFolderId: '', // å½“å‰æŸ¥çœ‹çš„æ–‡ä»¶å¤¹IDï¼ˆç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæ ¹ç›®å½•ï¼‰
        githubToken: localStorage.getItem('githubToken') || '',
        gistId: localStorage.getItem('gistId') || '',
        lastSync: localStorage.getItem('lastSync') || null,
        theme: localStorage.getItem('theme') || 'light'
      };

      // å½“å‰å¯¼èˆªè·¯å¾„
      let currentPath = [];

      // DOMå…ƒç´ 
      const contentGrid = document.getElementById('contentGrid');
      const breadcrumb = document.getElementById('breadcrumb');
      const linksContainer = document.getElementById('linksContainer');
      const linksList = document.getElementById('linksList');
      const currentFolderTitle = document.getElementById('currentFolderTitle');
      const currentFolderName = document.getElementById('currentFolderName');
      const currentFolderIcon = document.getElementById('currentFolderIcon');
      const backBtn = document.getElementById('backBtn');
      const searchInput = document.getElementById('searchInput');
      const syncStatus = document.getElementById('syncStatus');
      const syncStatusText = document.getElementById('syncStatusText');
      const notification = document.getElementById('notification');
      const lastSyncTime = document.getElementById('lastSyncTime');
      const folderCount = document.getElementById('folderCount');
      const linkCount = document.getElementById('linkCount');
      const subfolderCount = document.getElementById('subfolderCount');
      const quickActions = document.getElementById('quickActions');

      // ä¿®å¤ï¼šä¸ºé“¾æ¥è¡¨å•å’Œæ–‡ä»¶å¤¹è¡¨å•æ·»åŠ å˜é‡
      const folderForm = document.getElementById('folderForm');
      const linkForm = document.getElementById('linkForm');

      // åˆå§‹åŒ–
      initApp();

      function initApp() {
        // è®¾ç½®ä¸»é¢˜
        setTheme(appState.theme);

        // åŠ è½½æ•°æ®
        loadData();

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        updateStats();

        // æ›´æ–°æœ€ååŒæ­¥æ—¶é—´æ˜¾ç¤º
        updateLastSyncDisplay();

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        setupEventListeners();

        // æ¸²æŸ“å†…å®¹
        renderCurrentView();

        // å¦‚æœæœ‰GitHubä»¤ç‰Œï¼Œå°è¯•ä»GiståŒæ­¥
        if (appState.githubToken && appState.gistId) {
          setTimeout(() => syncWithGist('pull'), 1000);
        }
      }

      function loadData() {
        const savedFolders = localStorage.getItem('navFolders');
        const savedLinks = localStorage.getItem('navLinks');

        if (savedFolders) {
          try {
            appState.folders = JSON.parse(savedFolders);
          } catch (e) {
            console.error('è§£ææ–‡ä»¶å¤¹æ•°æ®å¤±è´¥:', e);
            appState.folders = [];
          }
        }

        if (savedLinks) {
          try {
            appState.links = JSON.parse(savedLinks);
          } catch (e) {
            console.error('è§£æé“¾æ¥æ•°æ®å¤±è´¥:', e);
            appState.links = [];
          }
        }

        // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ·»åŠ ç¤ºä¾‹æ•°æ®
        if (appState.folders.length === 0) {
          appState.folders = [
            {
              id: 'folder1',
              name: 'å·¥ä½œ',
              description: 'æ—¥å¸¸å·¥ä½œç›¸å…³é“¾æ¥',
              icon: 'briefcase',
              parentId: '',
              order: 1,
              createdAt: Date.now()
            },
            {
              id: 'folder2',
              name: 'å¼€å‘',
              description: 'ç¼–ç¨‹å’Œå¼€å‘èµ„æº',
              icon: 'code',
              parentId: '',
              order: 2,
              createdAt: Date.now()
            },
            {
              id: 'folder3',
              name: 'è®¾è®¡èµ„æº',
              description: 'UI/UXè®¾è®¡å·¥å…·å’Œç´ æ',
              icon: 'palette',
              parentId: 'folder2',
              order: 1,
              createdAt: Date.now()
            },
            {
              id: 'folder4',
              name: 'å‰ç«¯å¼€å‘',
              description: 'å‰ç«¯æ¡†æ¶å’Œå·¥å…·',
              icon: 'code',
              parentId: 'folder2',
              order: 2,
              createdAt: Date.now()
            }
          ];
        }

        if (appState.links.length === 0) {
          appState.links = [
            {
              id: 'link1',
              name: 'GitHub',
              url: 'https://github.com',
              folderId: 'folder2',
              icon: '',
              notes: 'ä»£ç æ‰˜ç®¡å¹³å°ï¼Œç”¨äºç‰ˆæœ¬æ§åˆ¶å’Œåä½œå¼€å‘',
              order: 1,
              createdAt: Date.now()
            },
            {
              id: 'link2',
              name: 'Google',
              url: 'https://google.com',
              folderId: '',
              icon: '',
              notes: 'æœç´¢å¼•æ“ï¼ŒæŸ¥æ‰¾ä¿¡æ¯å’Œèµ„æ–™',
              order: 2,
              createdAt: Date.now()
            },
            {
              id: 'link3',
              name: 'Figma',
              url: 'https://figma.com',
              folderId: 'folder3',
              icon: '',
              notes: 'åœ¨çº¿UIè®¾è®¡å·¥å…·ï¼Œæ”¯æŒå›¢é˜Ÿåä½œ',
              order: 1,
              createdAt: Date.now()
            },
            {
              id: 'link4',
              name: 'React',
              url: 'https://reactjs.org',
              folderId: 'folder4',
              icon: '',
              notes: 'ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„JavaScriptåº“',
              order: 1,
              createdAt: Date.now()
            }
          ];
        }

        // ä¿å­˜åˆå§‹æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        saveDataToLocalStorage();
      }

      function saveDataToLocalStorage() {
        localStorage.setItem('navFolders', JSON.stringify(appState.folders));
        localStorage.setItem('navLinks', JSON.stringify(appState.links));
      }

      function saveData() {
        saveDataToLocalStorage();

        // è‡ªåŠ¨åŒæ­¥åˆ°GitHub
        if (appState.githubToken) {
          syncWithGist('push');
        } else {
          showNotification('æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°', 'success');
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        updateStats();
      }

      function updateStats() {
        const totalFolders = appState.folders.length;
        const totalLinks = appState.links.length;
        const subfolders = appState.folders.filter(f => f.parentId !== '').length;

        folderCount.textContent = totalFolders;
        linkCount.textContent = totalLinks;
        subfolderCount.textContent = subfolders;
      }

      // ===================== å¯¼å‡ºåŠŸèƒ½ =====================

      // æ‰“å¼€å¯¼å‡ºæ¨¡æ€æ¡†
      function openExportModal() {
        document.getElementById('exportModal').classList.add('active');
      }

      // å¯¼å‡ºä¸ºHTMLæ–‡ä»¶
      function exportAsHtml() {
        const timestamp = new Date().toISOString().split('T')[0];
        const fileName = `æˆ‘çš„å¯¼èˆªé“¾æ¥-${timestamp}.html`;

        // æ„å»ºæ–‡ä»¶å¤¹æ ‘
        const folderTree = buildFolderTreeForExport();
        const rootLinks = appState.links
          .filter(link => !link.folderId)
          .sort((a, b) => (a.order || 0) - (b.order || 0));

        // ç”ŸæˆHTMLå†…å®¹
        const htmlContent = generateHtmlExport(folderTree, rootLinks);

        // åˆ›å»ºBlobå¹¶ä¸‹è½½
        const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showNotification(`å·²å¯¼å‡º${appState.links.length}ä¸ªé“¾æ¥åˆ°HTMLæ–‡ä»¶`, 'success');
        document.getElementById('exportModal').classList.remove('active');
      }

      // å¯¼å‡ºä¸ºJSONæ–‡ä»¶
      function exportAsJson() {
        const data = {
          folders: appState.folders,
          links: appState.links,
          exportedAt: new Date().toISOString(),
          appVersion: '2.1'
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `navigation-data-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showNotification('æ•°æ®å·²å¯¼å‡ºä¸ºJSON', 'success');
        document.getElementById('exportModal').classList.remove('active');
      }

      // å¯¼å‡ºä¸ºçº¯æ–‡æœ¬
      function exportAsText() {
        let textContent = `ä¸ªäººå¯¼èˆªé“¾æ¥å¯¼å‡º\nå¯¼å‡ºæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\n\n`;
        textContent += `æ€»é“¾æ¥æ•°ï¼š${appState.links.length}\næ€»æ–‡ä»¶å¤¹æ•°ï¼š${appState.folders.length}\n\n`;

        // æ„å»ºæ–‡ä»¶å¤¹æ ‘
        const folderTree = buildFolderTreeForExport();
        const rootLinks = appState.links
          .filter(link => !link.folderId)
          .sort((a, b) => (a.order || 0) - (b.order || 0));

        // æ·»åŠ æ ¹ç›®å½•é“¾æ¥
        if (rootLinks.length > 0) {
          textContent += "=== æ ¹ç›®å½•é“¾æ¥ ===\n\n";
          rootLinks.forEach(link => {
            textContent += `- ${link.name}\n  ç½‘å€ï¼š${link.url}\n`;
            if (link.notes) textContent += `  å¤‡æ³¨ï¼š${link.notes}\n`;
            textContent += '\n';
          });
        }

        // é€’å½’æ·»åŠ æ–‡ä»¶å¤¹å†…å®¹
        function addFolderToText(folder, level = 0) {
          const indent = '  '.repeat(level);
          textContent += `${indent}=== ${folder.name} ===\n`;
          if (folder.description) textContent += `${indent}æè¿°ï¼š${folder.description}\n\n`;

          // æ·»åŠ å½“å‰æ–‡ä»¶å¤¹çš„é“¾æ¥
          if (folder.links && folder.links.length > 0) {
            folder.links.forEach(link => {
              textContent += `${indent}- ${link.name}\n${indent}  ç½‘å€ï¼š${link.url}\n`;
              if (link.notes) textContent += `${indent}  å¤‡æ³¨ï¼š${link.notes}\n`;
              textContent += '\n';
            });
          }

          // é€’å½’å¤„ç†å­æ–‡ä»¶å¤¹
          if (folder.children && folder.children.length > 0) {
            folder.children.forEach(child => {
              addFolderToText(child, level + 1);
            });
          }
        }

        folderTree.forEach(folder => {
          addFolderToText(folder);
        });

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        navigator.clipboard.writeText(textContent).then(() => {
          showNotification('é“¾æ¥åˆ—è¡¨å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }).catch(err => {
          console.error('å¤åˆ¶å¤±è´¥:', err);
          showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
        });

        document.getElementById('exportModal').classList.remove('active');
      }

      // å¯¼å‡ºä¸ºCSVæ–‡ä»¶
      function exportAsCsv() {
        const timestamp = new Date().toISOString().split('T')[0];
        const fileName = `å¯¼èˆªé“¾æ¥-${timestamp}.csv`;

        // CSVæ ‡é¢˜è¡Œ
        let csvContent = "æ–‡ä»¶å¤¹,é“¾æ¥åç§°,URL,å¤‡æ³¨\n";

        // å¤„ç†æ ¹ç›®å½•é“¾æ¥
        appState.links
          .filter(link => !link.folderId)
          .forEach(link => {
            const folderName = "æ ¹ç›®å½•";
            const name = `"${link.name.replace(/"/g, '""')}"`;
            const url = `"${link.url}"`;
            const notes = link.notes ? `"${link.notes.replace(/"/g, '""')}"` : '';
            csvContent += `${folderName},${name},${url},${notes}\n`;
          });

        // å¤„ç†æ–‡ä»¶å¤¹ä¸­çš„é“¾æ¥
        appState.folders.forEach(folder => {
          const folderName = `"${folder.name.replace(/"/g, '""')}"`;
          appState.links
            .filter(link => link.folderId === folder.id)
            .forEach(link => {
              const name = `"${link.name.replace(/"/g, '""')}"`;
              const url = `"${link.url}"`;
              const notes = link.notes ? `"${link.notes.replace(/"/g, '""')}"` : '';
              csvContent += `${folderName},${name},${url},${notes}\n`;
            });
        });

        // åˆ›å»ºBlobå¹¶ä¸‹è½½
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showNotification('æ•°æ®å·²å¯¼å‡ºä¸ºCSVæ–‡ä»¶', 'success');
        document.getElementById('exportModal').classList.remove('active');
      }

      // ä¸ºå¯¼å‡ºæ„å»ºæ–‡ä»¶å¤¹æ ‘
      function buildFolderTreeForExport(parentId = '') {
        const folders = appState.folders.filter(f => f.parentId === parentId);
        const tree = [];

        folders.forEach(folder => {
          const children = buildFolderTreeForExport(folder.id);
          const folderLinks = appState.links
            .filter(link => link.folderId === folder.id)
            .sort((a, b) => (a.order || 0) - (b.order || 0));

          tree.push({
            ...folder,
            children,
            links: folderLinks
          });
        });

        return tree;
      }

      // ç”ŸæˆHTMLå¯¼å‡ºå†…å®¹
      function generateHtmlExport(folderTree, rootLinks) {
        const totalLinks = appState.links.length;
        const totalFolders = appState.folders.length;
        const exportDate = new Date().toLocaleString('zh-CN');

        return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å¯¼èˆªé“¾æ¥ - ${exportDate}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.5;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .header h1 {
            color: #0ea5e9;
            margin-bottom: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #0ea5e9;
        }
        
        .stat-label {
            font-size: 14px;
            color: #64748b;
        }
        
        .folder-section {
            margin-bottom: 40px;
        }
        
        .folder-header {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 0;
        }
        
        .folder-header i {
            font-size: 20px;
        }
        
        .folder-content {
            background: white;
            border-radius: 0 0 10px 10px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .link-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .link-item {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .link-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            border-color: #0ea5e9;
        }
        
        .link-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .link-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #0ea5e9;
            border: 1px solid #e2e8f0;
            flex-shrink: 0;
        }
        
        .link-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .link-title {
            font-weight: 600;
            font-size: 16px;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .link-url {
            font-size: 12px;
            color: #64748b;
            word-break: break-all;
        }
        
        .link-notes {
            font-size: 13px;
            color: #475569;
            line-height: 1.5;
            margin-top: 10px;
            padding: 10px;
            background: rgba(14, 165, 233, 0.05);
            border-radius: 6px;
            border-left: 3px solid #0ea5e9;
        }
        
        .subfolder {
            margin-left: 20px;
            margin-top: 20px;
            border-left: 3px solid #7dd3fc;
            padding-left: 20px;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            color: #64748b;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .link-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                gap: 15px;
            }
            
            .stat-item {
                min-width: 100px;
            }
        }
        
        .export-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #0ea5e9;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .back-to-top:hover {
            background: #38bdf8;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-compass"></i> æˆ‘çš„å¯¼èˆªé“¾æ¥</h1>
        <p>å¯¼å‡ºæ—¶é—´ï¼š${exportDate}</p>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value">${totalLinks}</div>
                <div class="stat-label">ä¸ªé“¾æ¥</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">${totalFolders}</div>
                <div class="stat-label">ä¸ªæ–‡ä»¶å¤¹</div>
            </div>
        </div>
        
        <div class="export-info">
            <p><i class="fas fa-info-circle"></i> æ­¤æ–‡ä»¶ç”±ä¸ªäººå¯¼èˆªé¡µç”Ÿæˆï¼ŒåŒ…å«æ‰€æœ‰å·²ä¿å­˜çš„é“¾æ¥ã€‚ç‚¹å‡»é“¾æ¥å³å¯åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ã€‚</p>
        </div>
    </div>
    
    ${generateHtmlFolderTree(folderTree, rootLinks)}
    
    <div class="footer">
        <p>ä¸ªäººå¯¼èˆªé¡µ &copy; ${new Date().getFullYear()} | ç”Ÿæˆæ—¶é—´ï¼š${exportDate}</p>
        <p>æ€»é“¾æ¥æ•°ï¼š${totalLinks} | æ€»æ–‡ä»¶å¤¹æ•°ï¼š${totalFolders}</p>
    </div>
    
    <a href="#" class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </a>
    
    <script>
        // è¿”å›é¡¶éƒ¨åŠŸèƒ½
        document.getElementById('backToTop').addEventListener('click', function(e) {
            e.preventDefault();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        // æ˜¾ç¤º/éšè—è¿”å›é¡¶éƒ¨æŒ‰é’®
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.scrollY > 300) {
                backToTop.style.display = 'flex';
            } else {
                backToTop.style.display = 'none';
            }
        });
        
        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            const backToTop = document.getElementById('backToTop');
            backToTop.style.display = 'none';
        });
        
        // è‡ªåŠ¨åŠ è½½ç½‘ç«™å›¾æ ‡
        document.querySelectorAll('.link-icon').forEach(icon => {
            const url = icon.dataset.url;
            if (url) {
                try {
                    const domain = new URL(url).hostname;
                    const faviconUrl = \`https://www.google.com/s2/favicons?domain=\${domain}&sz=64\`;
                    const img = new Image();
                    img.onload = function() {
                        icon.innerHTML = \`<img src="\${faviconUrl}" alt="å›¾æ ‡">\`;
                    };
                    img.onerror = function() {
                        // ä¿æŒé»˜è®¤å›¾æ ‡
                    };
                    img.src = faviconUrl;
                } catch (e) {
                    // URLæ— æ•ˆï¼Œå¿½ç•¥
                }
            }
        });
    </script>
</body>
</html>`;
      }

      // ç”ŸæˆHTMLæ–‡ä»¶å¤¹æ ‘
      function generateHtmlFolderTree(folderTree, rootLinks = [], level = 0) {
        let html = '';

        // æ¸²æŸ“æ ¹ç›®å½•é“¾æ¥
        if (rootLinks.length > 0 && level === 0) {
          html += `
          <div class="folder-section">
            <div class="folder-header">
              <i class="fas fa-home"></i>
              <h2>æ ¹ç›®å½•é“¾æ¥</h2>
            </div>
            <div class="folder-content">
              <div class="link-grid">
          `;

          rootLinks.forEach(link => {
            html += `
                <div class="link-item">
                  <div class="link-header">
                    <div class="link-icon" data-url="${link.url}">
                      <i class="fas fa-link"></i>
                    </div>
                    <div>
                      <div class="link-title">${link.name}</div>
                      <div class="link-url">${link.url}</div>
                    </div>
                  </div>
                  ${link.notes ? `<div class="link-notes">${link.notes}</div>` : ''}
                </div>
            `;
          });

          html += `
              </div>
            </div>
          </div>
          `;
        }

        // æ¸²æŸ“æ–‡ä»¶å¤¹æ ‘
        folderTree.forEach(folder => {
          const indentClass = level > 0 ? ' subfolder' : '';
          
          html += `
          <div class="folder-section${indentClass}">
            <div class="folder-header">
              <i class="fas fa-${folder.icon || 'folder'}"></i>
              <h2>${folder.name}${folder.description ? ` - ${folder.description}` : ''}</h2>
            </div>
            <div class="folder-content">
          `;

          if (folder.links.length > 0) {
            html += '<div class="link-grid">';
            
            folder.links.forEach(link => {
              html += `
                <div class="link-item">
                  <div class="link-header">
                    <div class="link-icon" data-url="${link.url}">
                      <i class="fas fa-link"></i>
                    </div>
                    <div>
                      <div class="link-title">${link.name}</div>
                      <div class="link-url">${link.url}</div>
                    </div>
                  </div>
                  ${link.notes ? `<div class="link-notes">${link.notes}</div>` : ''}
                </div>
              `;
            });
            
            html += '</div>';
          } else {
            html += '<p style="color: #64748b; text-align: center; padding: 20px;">æ­¤æ–‡ä»¶å¤¹æš‚æ— é“¾æ¥</p>';
          }

          // é€’å½’æ¸²æŸ“å­æ–‡ä»¶å¤¹
          if (folder.children.length > 0) {
            html += generateHtmlFolderTree(folder.children, [], level + 1);
          }

          html += `
            </div>
          </div>
          `;
        });

        return html;
      }

      // ===================== å…¶ä»–åŠŸèƒ½ =====================

      async function syncWithGist(action) {
        if (!appState.githubToken) {
          if (action === 'pull') return;
          showNotification('è¯·å…ˆé…ç½®GitHubä»¤ç‰Œ', 'warning');
          return;
        }

        syncStatusText.textContent = action === 'push' ? 'æ­£åœ¨æ¨é€æ•°æ®...' : 'æ­£åœ¨æ‹‰å–æ•°æ®...';
        syncStatus.style.display = 'flex';

        try {
          const data = {
            folders: appState.folders,
            links: appState.links,
            updatedAt: new Date().toISOString(),
            appVersion: '2.1'
          };

          if (action === 'push') {
            if (appState.gistId) {
              await updateGist(appState.gistId, data);
              appState.lastSync = new Date().toISOString();
              localStorage.setItem('lastSync', appState.lastSync);
              updateLastSyncDisplay();
              showNotification('æ•°æ®å·²åŒæ­¥åˆ°GitHub', 'success');
            } else {
              // å¦‚æœæ²¡æœ‰Gist IDï¼Œå…ˆåˆ›å»ºGist
              const gistId = await createGist(data);
              if (gistId) {
                appState.gistId = gistId;
                localStorage.setItem('gistId', gistId);
                appState.lastSync = new Date().toISOString();
                localStorage.setItem('lastSync', appState.lastSync);
                updateLastSyncDisplay();
                showNotification('Giståˆ›å»ºæˆåŠŸï¼Œæ•°æ®å·²åŒæ­¥', 'success');
              }
            }
          } else if (action === 'pull') {
            if (appState.gistId) {
              const remoteData = await fetchGist(appState.gistId);
              if (remoteData) {
                // åˆå¹¶æ•°æ®ï¼šä½¿ç”¨è¿œç¨‹æ•°æ®
                appState.folders = remoteData.folders || [];
                appState.links = remoteData.links || [];
                appState.lastSync = remoteData.updatedAt;
                localStorage.setItem('lastSync', appState.lastSync);

                // ä¿å­˜åˆ°æœ¬åœ°
                saveDataToLocalStorage();

                // æ›´æ–°UI
                updateStats();
                renderCurrentView();
                updateLastSyncDisplay();
                showNotification('å·²ä»GitHubåŒæ­¥æ•°æ®', 'success');
              }
            }
          }
        } catch (error) {
          console.error('åŒæ­¥å¤±è´¥:', error);
          showNotification(`${action === 'push' ? 'æ¨é€' : 'æ‹‰å–'}å¤±è´¥: ${error.message}`, 'error');
        } finally {
          setTimeout(() => {
            syncStatus.style.display = 'none';
          }, 1000);
        }
      }

      async function createGist(data) {
        try {
          const response = await fetch('https://api.github.com/gists', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${appState.githubToken}`,
              'Content-Type': 'application/json',
              'Accept': 'application/vnd.github.v3+json',
              'User-Agent': 'Personal-Navigation-App'
            },
            body: JSON.stringify({
              description: 'ä¸ªäººå¯¼èˆªæ•°æ®',
              public: false,
              files: {
                'navigation.json': {
                  content: JSON.stringify(data, null, 2)
                }
              }
            })
          });

          if (!response.ok) {
            throw new Error(`åˆ›å»ºGistå¤±è´¥: ${response.status}`);
          }

          const result = await response.json();
          return result.id;
        } catch (error) {
          throw error;
        }
      }

      async function updateGist(gistId, data) {
        try {
          const response = await fetch(`https://api.github.com/gists/${gistId}`, {
            method: 'PATCH',
            headers: {
              'Authorization': `Bearer ${appState.githubToken}`,
              'Content-Type': 'application/json',
              'Accept': 'application/vnd.github.v3+json',
              'User-Agent': 'Personal-Navigation-App'
            },
            body: JSON.stringify({
              description: 'ä¸ªäººå¯¼èˆªæ•°æ®',
              files: {
                'navigation.json': {
                  content: JSON.stringify(data, null, 2)
                }
              }
            })
          });

          if (!response.ok) {
            throw new Error(`æ›´æ–°Gistå¤±è´¥: ${response.status}`);
          }
        } catch (error) {
          throw error;
        }
      }

      async function fetchGist(gistId) {
        try {
          const response = await fetch(`https://api.github.com/gists/${gistId}`, {
            headers: {
              'Authorization': `Bearer ${appState.githubToken}`,
              'Accept': 'application/vnd.github.v3+json',
              'User-Agent': 'Personal-Navigation-App'
            }
          });

          if (!response.ok) {
            throw new Error(`è·å–Gistå¤±è´¥: ${response.status}`);
          }

          const result = await response.json();
          const content = result.files['navigation.json'].content;
          return JSON.parse(content);
        } catch (error) {
          throw error;
        }
      }

      function renderCurrentView() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        const isSearching = searchTerm !== '';

        // æ¸…ç©ºå†…å®¹
        contentGrid.innerHTML = '';
        quickActions.innerHTML = '';

        if (isSearching) {
          // æœç´¢æ¨¡å¼
          renderSearchResults(searchTerm);
        } else if (appState.currentFolderId === '') {
          // æ ¹ç›®å½•è§†å›¾
          renderFolderView('');
          backBtn.style.display = 'none';
        } else {
          // æ–‡ä»¶å¤¹è¯¦æƒ…è§†å›¾
          renderFolderDetails(appState.currentFolderId);
          backBtn.style.display = 'block';
        }
      }

      function renderFolderView(parentId) {
        // è·å–å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„å­æ–‡ä»¶å¤¹
        const subfolders = appState.folders
          .filter(folder => folder.parentId === parentId)
          .sort((a, b) => (a.order || 0) - (b.order || 0));

        // æ˜¾ç¤º/éšè—å†…å®¹åŒºåŸŸ
        if (parentId === '') {
          contentGrid.style.display = 'grid';
          linksContainer.style.display = 'none';
        } else {
          contentGrid.style.display = 'none';
          linksContainer.style.display = 'block';
        }

        // å¦‚æœæ²¡æœ‰å­æ–‡ä»¶å¤¹ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
        if (subfolders.length === 0 && parentId === '') {
          contentGrid.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-compass"></i>
            <h3>æ‚¨çš„å¯¼èˆªé¡µæ˜¯ç©ºçš„</h3>
            <p>å¼€å§‹æ·»åŠ ç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹æˆ–é“¾æ¥å§ï¼</p>
            <div style="margin-top: 20px;">
              <button class="btn" id="firstFolderBtn">
                <i class="fas fa-folder-plus"></i> åˆ›å»ºç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹
              </button>
            </div>
          </div>
          `;

          // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
          document.getElementById('firstFolderBtn').addEventListener('click', () => {
            openFolderModal('');
          });

          return;
        }

        // æ¸²æŸ“å­æ–‡ä»¶å¤¹
        subfolders.forEach(folder => {
          const folderCard = createFolderCard(folder);
          contentGrid.appendChild(folderCard);
        });

        // å¦‚æœæ˜¯æ ¹ç›®å½•ï¼Œæ˜¾ç¤ºå¿«é€Ÿæ“ä½œ
        if (parentId === '') {
          updateQuickActions();
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        updateBreadcrumb(parentId);
      }

      function renderFolderDetails(folderId) {
        const folder = appState.folders.find(f => f.id === folderId);
        if (!folder) return;

        // æ›´æ–°æ–‡ä»¶å¤¹è¯¦æƒ…é¡µæ ‡é¢˜
        currentFolderName.textContent = folder.name;
        currentFolderIcon.className = `fas fa-${folder.icon || 'folder'}`;

        // è·å–å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„å­æ–‡ä»¶å¤¹
        const subfolders = appState.folders
          .filter(f => f.parentId === folderId)
          .sort((a, b) => (a.order || 0) - (b.order || 0));

        // è·å–å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„é“¾æ¥
        const folderLinks = appState.links
          .filter(link => link.folderId === folderId)
          .sort((a, b) => (a.order || 0) - (b.order || 0));

        // æ˜¾ç¤ºæ–‡ä»¶å¤¹è¯¦æƒ…é¡µ
        contentGrid.style.display = 'none';
        linksContainer.style.display = 'block';

        // æ¸…ç©ºé“¾æ¥åˆ—è¡¨
        linksList.innerHTML = '';

        // æ¸²æŸ“å­æ–‡ä»¶å¤¹ï¼ˆåœ¨é“¾æ¥åˆ—è¡¨é¡¶éƒ¨ï¼‰
        subfolders.forEach(subfolder => {
          const folderCard = createLinkCard(subfolder, true);
          linksList.appendChild(folderCard);
        });

        // æ¸²æŸ“é“¾æ¥
        if (folderLinks.length === 0 && subfolders.length === 0) {
          linksList.innerHTML = `
          <div class="empty-state" style="grid-column: 1 / -1;">
            <i class="fas fa-folder-open"></i>
            <h3>è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ç©ºçš„</h3>
            <p>æ·»åŠ ä¸€äº›é“¾æ¥æˆ–å­æ–‡ä»¶å¤¹å§ï¼</p>
          </div>
          `;
        } else {
          folderLinks.forEach(link => {
            const linkCard = createLinkCard(link, false);
            linksList.appendChild(linkCard);
          });
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        updateBreadcrumb(folderId);
      }

      function renderSearchResults(searchTerm) {
        // æœç´¢æ–‡ä»¶å¤¹
        const matchedFolders = appState.folders.filter(folder =>
          folder.name.toLowerCase().includes(searchTerm) ||
          (folder.description && folder.description.toLowerCase().includes(searchTerm))
        );

        // æœç´¢é“¾æ¥
        const matchedLinks = appState.links.filter(link =>
          link.name.toLowerCase().includes(searchTerm) ||
          link.url.toLowerCase().includes(searchTerm) ||
          (link.notes && link.notes.toLowerCase().includes(searchTerm))
        );

        // æ¸…ç©ºå†…å®¹
        contentGrid.innerHTML = '';

        // æ˜¾ç¤ºæœç´¢ç»“æœç»Ÿè®¡
        const resultCount = matchedFolders.length + matchedLinks.length;
        quickActions.innerHTML = `
        <div style="color: var(--text-secondary); font-size: 14px; padding: 10px 0;">
          æ‰¾åˆ° ${resultCount} ä¸ªç»“æœ (${matchedFolders.length} ä¸ªæ–‡ä»¶å¤¹, ${matchedLinks.length} ä¸ªé“¾æ¥)
        </div>
        `;

        // éšè—å…¶ä»–è§†å›¾
        linksContainer.style.display = 'none';
        backBtn.style.display = 'none';
        contentGrid.style.display = 'grid';

        if (resultCount === 0) {
          contentGrid.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-search"></i>
            <h3>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç»“æœ</h3>
            <p>å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯æœç´¢</p>
          </div>
          `;
          return;
        }

        // æ¸²æŸ“åŒ¹é…çš„æ–‡ä»¶å¤¹
        matchedFolders.forEach(folder => {
          const folderCard = createFolderCard(folder);
          contentGrid.appendChild(folderCard);
        });

        // æ¸²æŸ“åŒ¹é…çš„é“¾æ¥ï¼ˆä»¥å¡ç‰‡å½¢å¼æ˜¾ç¤ºï¼‰
        matchedLinks.forEach(link => {
          const linkCard = createLinkCard(link, false, true);
          contentGrid.appendChild(linkCard);
        });
      }

      function createFolderCard(folder) {
        const folderCard = document.createElement('div');
        folderCard.className = 'folder-card';
        folderCard.dataset.id = folder.id;

        // è·å–å­æ–‡ä»¶å¤¹å’Œé“¾æ¥æ•°é‡
        const subfolderCount = appState.folders.filter(f => f.parentId === folder.id).length;
        const linkCount = appState.links.filter(link => link.folderId === folder.id).length;

        folderCard.innerHTML = `
        <div class="folder-header">
          <div class="folder-info">
            <div class="folder-icon">
              <i class="fas fa-${folder.icon || 'folder'}"></i>
            </div>
            <div class="folder-text">
              <div class="folder-title">${folder.name}</div>
              <div class="folder-desc">${folder.description || ''}</div>
            </div>
          </div>
          <div class="folder-actions">
            <button class="btn btn-small btn-secondary edit-folder-btn" data-id="${folder.id}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-small btn-danger delete-folder-btn" data-id="${folder.id}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        <div class="folder-stats">
          <span>${subfolderCount} ä¸ªå­æ–‡ä»¶å¤¹</span>
          <span>${linkCount} ä¸ªé“¾æ¥</span>
        </div>
        `;

        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆè¿›å…¥æ–‡ä»¶å¤¹ï¼‰
        folderCard.addEventListener('click', function (e) {
          if (!e.target.closest('.folder-actions')) {
            navigateToFolder(folder.id);
          }
        });

        // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®äº‹ä»¶
        folderCard.querySelector('.edit-folder-btn').addEventListener('click', function (e) {
          e.stopPropagation();
          openFolderModal(this.dataset.id);
        });

        folderCard.querySelector('.delete-folder-btn').addEventListener('click', function (e) {
          e.stopPropagation();
          deleteFolder(this.dataset.id);
        });

        return folderCard;
      }

      function createLinkCard(item, isFolder = false, isSearchResult = false) {
        const card = document.createElement('div');
        card.className = 'link-card';

        if (isFolder) {
          // åˆ›å»ºæ–‡ä»¶å¤¹å¡ç‰‡ï¼ˆåœ¨é“¾æ¥åˆ—è¡¨ä¸­ï¼‰
          const folder = item;
          const subfolderCount = appState.folders.filter(f => f.parentId === folder.id).length;
          const linkCount = appState.links.filter(link => link.folderId === folder.id).length;

          card.innerHTML = `
          <div class="link-header">
            <div class="link-icon-container">
              <i class="fas fa-${folder.icon || 'folder'}"></i>
            </div>
            <div class="link-title-container">
              <div class="link-title">${folder.name}</div>
              <div class="link-url">æ–‡ä»¶å¤¹</div>
              ${folder.description ? `<div class="link-notes" style="margin-top: 8px; font-size: 12px;">${folder.description}</div>` : ''}
            </div>
          </div>
          <div class="link-actions">
            <button class="btn btn-small" data-id="${folder.id}">
              <i class="fas fa-folder-open"></i> æ‰“å¼€
            </button>
            <button class="btn btn-small btn-secondary edit-folder-btn" data-id="${folder.id}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-small btn-danger delete-folder-btn" data-id="${folder.id}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          `;

          // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
          card.querySelector('button:first-child').addEventListener('click', function (e) {
            e.stopPropagation();
            navigateToFolder(this.dataset.id);
          });

          card.querySelector('.edit-folder-btn').addEventListener('click', function (e) {
            e.stopPropagation();
            openFolderModal(this.dataset.id);
          });

          card.querySelector('.delete-folder-btn').addEventListener('click', function (e) {
            e.stopPropagation();
            deleteFolder(this.dataset.id);
          });

        } else {
          // åˆ›å»ºé“¾æ¥å¡ç‰‡
          const link = item;
          const folder = appState.folders.find(f => f.id === link.folderId);
          const folderName = folder ? folder.name : 'æ ¹ç›®å½•';

          card.innerHTML = `
          <div class="link-header">
            <div class="link-icon-container" id="linkIcon-${link.id}">
              <i class="fas fa-link"></i>
            </div>
            <div class="link-title-container">
              <div class="link-title">${link.name}</div>
              <div class="link-url">${link.url}</div>
              <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                ä½äº: ${folderName}
              </div>
            </div>
          </div>
          ${link.notes ? `<div class="link-notes">${link.notes}</div>` : ''}
          <div class="link-actions">
            <a href="${link.url}" target="_blank" class="btn btn-small" onclick="event.stopPropagation();">
              <i class="fas fa-external-link-alt"></i> è®¿é—®
            </a>
            <button class="btn btn-small btn-secondary edit-link-btn" data-id="${link.id}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-small btn-danger delete-link-btn" data-id="${link.id}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          `;

          // åŠ è½½é“¾æ¥å›¾æ ‡
          loadLinkIcon(link);

          // å¦‚æœæ˜¯æœç´¢ç»“æœï¼Œæ·»åŠ ç‚¹å‡»æ‰“å¼€åŠŸèƒ½
          if (isSearchResult) {
            card.style.cursor = 'pointer';
            card.addEventListener('click', function (e) {
              if (!e.target.closest('.link-actions')) {
                window.open(link.url, '_blank');
              }
            });
          }

          // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®äº‹ä»¶
          card.querySelector('.edit-link-btn').addEventListener('click', function (e) {
            e.stopPropagation();
            editLink(this.dataset.id);
          });

          card.querySelector('.delete-link-btn').addEventListener('click', function (e) {
            e.stopPropagation();
            deleteLink(this.dataset.id);
          });
        }

        return card;
      }

      function loadLinkIcon(link) {
        if (!link.icon && link.url) {
          try {
            const domain = new URL(link.url).hostname;
            const faviconUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;

            const iconContainer = document.getElementById(`linkIcon-${link.id}`);
            if (iconContainer) {
              const img = new Image();
              img.onload = function () {
                iconContainer.innerHTML = `<img src="${faviconUrl}" alt="${link.name}">`;
              };
              img.onerror = function () {
                // ä¿æŒé»˜è®¤å›¾æ ‡
              };
              img.src = faviconUrl;
            }
          } catch (e) {
            // URLæ— æ•ˆï¼Œå¿½ç•¥
          }
        } else if (link.icon) {
          const iconContainer = document.getElementById(`linkIcon-${link.id}`);
          if (iconContainer) {
            iconContainer.innerHTML = `<img src="${link.icon}" alt="${link.name}">`;
          }
        }
      }

      function updateQuickActions() {
        // è·å–æ ¹ç›®å½•ä¸‹çš„é“¾æ¥æ•°é‡
        const rootLinks = appState.links.filter(link => link.folderId === '').length;

        quickActions.innerHTML = `
        <button class="btn btn-secondary" id="viewRootLinksBtn">
          <i class="fas fa-link"></i> æŸ¥çœ‹æ ¹ç›®å½•é“¾æ¥ (${rootLinks})
        </button>
        <button class="btn btn-secondary" id="viewAllFoldersBtn">
          <i class="fas fa-sitemap"></i> æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶å¤¹
        </button>
        `;

        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('viewRootLinksBtn').addEventListener('click', function () {
          showRootLinks();
        });

        document.getElementById('viewAllFoldersBtn').addEventListener('click', function () {
          showAllFolders();
        });
      }

      function showRootLinks() {
        appState.currentFolderId = '';
        contentGrid.style.display = 'none';
        linksContainer.style.display = 'block';

        // æ›´æ–°æ ‡é¢˜
        currentFolderName.textContent = 'æ ¹ç›®å½•é“¾æ¥';
        currentFolderIcon.className = 'fas fa-home';

        // è·å–æ ¹ç›®å½•é“¾æ¥
        const rootLinks = appState.links
          .filter(link => link.folderId === '')
          .sort((a, b) => (a.order || 0) - (b.order || 0));

        // æ¸…ç©ºé“¾æ¥åˆ—è¡¨
        linksList.innerHTML = '';

        if (rootLinks.length === 0) {
          linksList.innerHTML = `
          <div class="empty-state" style="grid-column: 1 / -1;">
            <i class="fas fa-link"></i>
            <h3>æ ¹ç›®å½•æ²¡æœ‰é“¾æ¥</h3>
            <p>æ·»åŠ ä¸€äº›é“¾æ¥åˆ°æ ¹ç›®å½•å§ï¼</p>
          </div>
          `;
        } else {
          rootLinks.forEach(link => {
            const linkCard = createLinkCard(link, false);
            linksList.appendChild(linkCard);
          });
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        breadcrumb.innerHTML = `
        <div class="breadcrumb-item active" data-id="">æ ¹ç›®å½•</div>
        <div class="breadcrumb-separator">/</div>
        <div class="breadcrumb-item active">é“¾æ¥</div>
        `;

        backBtn.style.display = 'block';
      }

      function showAllFolders() {
        // æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶å¤¹çš„æ ‘çŠ¶è§†å›¾
        contentGrid.innerHTML = '';

        // æ„å»ºæ–‡ä»¶å¤¹æ ‘
        const folderTree = buildFolderTree();

        // æ¸²æŸ“æ–‡ä»¶å¤¹æ ‘
        renderFolderTree(folderTree);

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        breadcrumb.innerHTML = `
        <div class="breadcrumb-item active" data-id="">æ ¹ç›®å½•</div>
        <div class="breadcrumb-separator">/</div>
        <div class="breadcrumb-item active">æ‰€æœ‰æ–‡ä»¶å¤¹</div>
        `;

        backBtn.style.display = 'block';
      }

      function buildFolderTree(parentId = '', level = 0) {
        const folders = appState.folders.filter(f => f.parentId === parentId);
        const tree = [];

        folders.forEach(folder => {
          const children = buildFolderTree(folder.id, level + 1);
          const linkCount = appState.links.filter(link => link.folderId === folder.id).length;

          tree.push({
            ...folder,
            level,
            children,
            linkCount
          });
        });

        return tree;
      }

      function renderFolderTree(tree) {
        tree.forEach(item => {
          const indent = item.level * 20;
          const folderCard = document.createElement('div');
          folderCard.className = 'folder-card';
          folderCard.style.marginLeft = `${indent}px`;
          folderCard.style.borderLeft = item.level > 0 ? `3px solid var(--primary-color)` : 'none';

          folderCard.innerHTML = `
          <div class="folder-header">
            <div class="folder-info">
              <div class="folder-icon" style="background: linear-gradient(135deg, #a5b4fc 0%, #818cf8 100%); opacity: ${1 - item.level * 0.1}">
                <i class="fas fa-${item.icon || 'folder'}"></i>
              </div>
              <div class="folder-text">
                <div class="folder-title">${item.name}</div>
                <div class="folder-desc">${item.description || ''}</div>
              </div>
            </div>
            <div class="folder-actions">
              <button class="btn btn-small" data-id="${item.id}">
                <i class="fas fa-folder-open"></i>
              </button>
              <button class="btn btn-small btn-secondary edit-folder-btn" data-id="${item.id}">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          </div>
          <div class="folder-stats">
            <span>${item.children.length} ä¸ªå­æ–‡ä»¶å¤¹</span>
            <span>${item.linkCount} ä¸ªé“¾æ¥</span>
          </div>
          `;

          contentGrid.appendChild(folderCard);

          // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
          folderCard.querySelector('button:first-child').addEventListener('click', function (e) {
            navigateToFolder(this.dataset.id);
          });

          folderCard.querySelector('.edit-folder-btn').addEventListener('click', function (e) {
            openFolderModal(this.dataset.id);
          });

          // é€’å½’æ¸²æŸ“å­æ–‡ä»¶å¤¹
          if (item.children.length > 0) {
            renderFolderTree(item.children);
          }
        });
      }

      function navigateToFolder(folderId) {
        appState.currentFolderId = folderId;
        renderCurrentView();
      }

      function updateBreadcrumb(folderId) {
        breadcrumb.innerHTML = '';

        // æ ¹ç›®å½•
        breadcrumb.innerHTML = '<div class="breadcrumb-item" data-id="">æ ¹ç›®å½•</div>';

        // å¦‚æœå½“å‰ä¸åœ¨æ ¹ç›®å½•ï¼Œæ„å»ºè·¯å¾„
        if (folderId) {
          const path = getFolderPath(folderId);

          path.forEach(folder => {
            breadcrumb.innerHTML += '<div class="breadcrumb-separator">/</div>';
            breadcrumb.innerHTML += `<div class="breadcrumb-item" data-id="${folder.id}">${folder.name}</div>`;
          });

          // æœ€åä¸€ä¸ªä¸ºå½“å‰æ–‡ä»¶å¤¹
          const lastItem = breadcrumb.querySelector('.breadcrumb-item:last-child');
          lastItem.classList.add('active');
        } else {
          // æ ¹ç›®å½•ä¸ºå½“å‰
          const rootItem = breadcrumb.querySelector('.breadcrumb-item');
          rootItem.classList.add('active');
        }

        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        breadcrumb.querySelectorAll('.breadcrumb-item:not(.active)').forEach(item => {
          item.addEventListener('click', function () {
            navigateToFolder(this.dataset.id);
          });
        });
      }

      function getFolderPath(folderId) {
        const path = [];
        let currentId = folderId;

        while (currentId) {
          const folder = appState.folders.find(f => f.id === currentId);
          if (folder) {
            path.unshift(folder);
            currentId = folder.parentId;
          } else {
            break;
          }
        }

        return path;
      }

      function openFolderModal(folderId = null) {
        const modal = document.getElementById('folderModal');
        const title = document.getElementById('folderModalTitle');
        const form = document.getElementById('folderForm');
        const nameInput = document.getElementById('folderName');
        const descInput = document.getElementById('folderDescription');
        const parentSelect = document.getElementById('parentFolder');
        const iconInput = document.getElementById('folderIcon');

        // é‡ç½®è¡¨å•
        form.reset();

        // å¡«å……çˆ¶æ–‡ä»¶å¤¹é€‰æ‹©
        parentSelect.innerHTML = '<option value="">æ—  (æ ¹ç›®å½•)</option>';
        appState.folders.forEach(folder => {
          // æ’é™¤å½“å‰æ–‡ä»¶å¤¹ï¼ˆé¿å…å¾ªç¯å¼•ç”¨ï¼‰
          if (folder.id !== folderId) {
            const option = document.createElement('option');
            option.value = folder.id;
            option.textContent = folder.name;

            // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ä¸”å½“å‰æ–‡ä»¶å¤¹æœ‰çˆ¶æ–‡ä»¶å¤¹ï¼Œåˆ™é€‰ä¸­
            if (folderId) {
              const currentFolder = appState.folders.find(f => f.id === folderId);
              if (currentFolder && currentFolder.parentId === folder.id) {
                option.selected = true;
              }
            }

            parentSelect.appendChild(option);
          }
        });

        if (folderId) {
          // ç¼–è¾‘æ¨¡å¼
          appState.editingFolderId = folderId;
          title.textContent = 'ç¼–è¾‘æ–‡ä»¶å¤¹';
          const folder = appState.folders.find(f => f.id === folderId);

          if (folder) {
            nameInput.value = folder.name;
            descInput.value = folder.description || '';
            iconInput.value = folder.icon || 'folder';

            // é€‰æ‹©å¯¹åº”çš„å›¾æ ‡
            document.querySelectorAll('.folder-icon-option').forEach(option => {
              if (option.dataset.icon === folder.icon) {
                option.classList.add('selected');
              } else {
                option.classList.remove('selected');
              }
            });
          }
        } else {
          // æ–°å»ºæ¨¡å¼
          appState.editingFolderId = null;
          title.textContent = 'æ–°å»ºæ–‡ä»¶å¤¹';
          iconInput.value = 'folder';

          // é»˜è®¤é€‰æ‹©å½“å‰æ–‡ä»¶å¤¹ä½œä¸ºçˆ¶æ–‡ä»¶å¤¹
          if (appState.currentFolderId) {
            parentSelect.value = appState.currentFolderId;
          }

          // é‡ç½®å›¾æ ‡é€‰æ‹©
          document.querySelectorAll('.folder-icon-option').forEach(option => {
            if (option.dataset.icon === 'folder') {
              option.classList.add('selected');
            } else {
              option.classList.remove('selected');
            }
          });
        }

        modal.classList.add('active');

        // èšç„¦åˆ°åç§°è¾“å…¥æ¡†
        setTimeout(() => nameInput.focus(), 100);
      }

      function openLinkModal(folderId = null) {
        const modal = document.getElementById('linkModal');
        const title = document.getElementById('linkModalTitle');
        const form = document.getElementById('linkForm');
        const nameInput = document.getElementById('linkName');
        const urlInput = document.getElementById('linkUrl');
        const notesInput = document.getElementById('linkNotes');
        const folderSelect = document.getElementById('linkFolder');
        const iconPreview = document.getElementById('linkIconPreview');

        // é‡ç½®è¡¨å•
        form.reset();
        appState.editingLinkId = null;
        title.textContent = 'æ·»åŠ é“¾æ¥';

        // å¡«å……æ–‡ä»¶å¤¹é€‰æ‹©
        folderSelect.innerHTML = '<option value="">æ—  (æ˜¾ç¤ºåœ¨æ ¹ç›®å½•)</option>';
        appState.folders.forEach(folder => {
          const option = document.createElement('option');
          option.value = folder.id;
          option.textContent = folder.name;
          folderSelect.appendChild(option);
        });

        // å¦‚æœæŒ‡å®šäº†æ–‡ä»¶å¤¹ï¼Œåˆ™é€‰ä¸­
        if (folderId !== null) {
          folderSelect.value = folderId;
        }

        // é‡ç½®å›¾æ ‡é¢„è§ˆ
        iconPreview.innerHTML = '<i class="fas fa-link"></i>';

        // URLè¾“å…¥æ—¶å°è¯•è·å–å›¾æ ‡
        urlInput.addEventListener('input', async function () {
          if (this.value && this.value.includes('.')) {
            try {
              const domain = new URL(this.value).hostname;
              const faviconUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;

              // æµ‹è¯•å›¾ç‰‡æ˜¯å¦èƒ½åŠ è½½
              const img = new Image();
              img.onload = function () {
                iconPreview.innerHTML = `<img src="${faviconUrl}" alt="ç½‘ç«™å›¾æ ‡">`;
              };
              img.onerror = function () {
                iconPreview.innerHTML = '<i class="fas fa-link"></i>';
              };
              img.src = faviconUrl;
            } catch (e) {
              // URLæ— æ•ˆï¼Œå¿½ç•¥
            }
          }
        });

        modal.classList.add('active');

        // èšç„¦åˆ°åç§°è¾“å…¥æ¡†
        setTimeout(() => nameInput.focus(), 100);
      }

      function editLink(linkId) {
        const link = appState.links.find(l => l.id === linkId);
        if (!link) return;

        const modal = document.getElementById('linkModal');
        const title = document.getElementById('linkModalTitle');
        const form = document.getElementById('linkForm');
        const nameInput = document.getElementById('linkName');
        const urlInput = document.getElementById('linkUrl');
        const notesInput = document.getElementById('linkNotes');
        const folderSelect = document.getElementById('linkFolder');
        const iconPreview = document.getElementById('linkIconPreview');

        appState.editingLinkId = linkId;
        title.textContent = 'ç¼–è¾‘é“¾æ¥';

        // å¡«å……è¡¨å•
        nameInput.value = link.name;
        urlInput.value = link.url;
        notesInput.value = link.notes || '';

        // å¡«å……æ–‡ä»¶å¤¹é€‰æ‹©
        folderSelect.innerHTML = '<option value="">æ—  (æ˜¾ç¤ºåœ¨æ ¹ç›®å½•)</option>';
        appState.folders.forEach(folder => {
          const option = document.createElement('option');
          option.value = folder.id;
          option.textContent = folder.name;
          if (folder.id === link.folderId) {
            option.selected = true;
          }
          folderSelect.appendChild(option);
        });

        // æ˜¾ç¤ºå›¾æ ‡
        if (link.icon) {
          iconPreview.innerHTML = `<img src="${link.icon}" alt="${link.name}">`;
        } else {
          iconPreview.innerHTML = '<i class="fas fa-link"></i>';
        }

        modal.classList.add('active');
      }

      function deleteLink(linkId) {
        const link = appState.links.find(l => l.id === linkId);
        if (!link) return;

        if (confirm(`ç¡®å®šè¦åˆ é™¤é“¾æ¥ "${link.name}" å—ï¼Ÿ`)) {
          appState.links = appState.links.filter(l => l.id !== linkId);
          saveData();
          renderCurrentView();
          showNotification('é“¾æ¥å·²åˆ é™¤', 'success');
        }
      }

      function deleteFolder(folderId) {
        const folder = appState.folders.find(f => f.id === folderId);
        if (!folder) return;

        // æ£€æŸ¥æ–‡ä»¶å¤¹ä¸­æ˜¯å¦æœ‰å­æ–‡ä»¶å¤¹
        const subfolders = appState.folders.filter(f => f.parentId === folderId);
        // æ£€æŸ¥æ–‡ä»¶å¤¹ä¸­æ˜¯å¦æœ‰é“¾æ¥
        const folderLinks = appState.links.filter(l => l.folderId === folderId);

        let message = `ç¡®å®šè¦åˆ é™¤æ–‡ä»¶å¤¹ "${folder.name}" å—ï¼Ÿ`;
        if (subfolders.length > 0 || folderLinks.length > 0) {
          message = `æ–‡ä»¶å¤¹ "${folder.name}" ä¸­åŒ…å« ${subfolders.length} ä¸ªå­æ–‡ä»¶å¤¹å’Œ ${folderLinks.length} ä¸ªé“¾æ¥ï¼Œåˆ é™¤æ–‡ä»¶å¤¹å°†åŒæ—¶åˆ é™¤è¿™äº›å†…å®¹ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`;
        }

        if (confirm(message)) {
          // åˆ é™¤æ–‡ä»¶å¤¹å’Œå…¶ä¸­çš„å†…å®¹
          appState.folders = appState.folders.filter(f => f.id !== folderId);
          appState.links = appState.links.filter(l => l.folderId !== folderId);

          // é€’å½’åˆ é™¤å­æ–‡ä»¶å¤¹
          function deleteSubfolders(parentId) {
            const children = appState.folders.filter(f => f.parentId === parentId);
            children.forEach(child => {
              appState.folders = appState.folders.filter(f => f.id !== child.id);
              appState.links = appState.links.filter(l => l.folderId !== child.id);
              deleteSubfolders(child.id);
            });
          }

          deleteSubfolders(folderId);
          saveData();
          renderCurrentView();
          showNotification('æ–‡ä»¶å¤¹å·²åˆ é™¤', 'success');
        }
      }

      function showNotification(message, type = 'info') {
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add('show');

        setTimeout(() => {
          notification.classList.remove('show');
        }, 3000);
      }

      function updateLastSyncDisplay() {
        if (appState.lastSync) {
          const date = new Date(appState.lastSync);
          lastSyncTime.textContent = date.toLocaleString('zh-CN');
        } else {
          lastSyncTime.textContent = 'ä»æœªåŒæ­¥';
        }
      }

      function setTheme(theme) {
        // æ¸…é™¤ç°æœ‰ä¸»é¢˜ç±»
        document.body.classList.remove('dark-mode');

        if (theme === 'dark') {
          document.body.classList.add('dark-mode');
          themeIcon.className = 'fas fa-sun';
        } else if (theme === 'light') {
          themeIcon.className = 'fas fa-moon';
        } else if (theme === 'auto') {
          // è‡ªåŠ¨æ¨¡å¼ï¼šæ ¹æ®ç³»ç»Ÿåå¥½è®¾ç½®
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          if (prefersDark) {
            document.body.classList.add('dark-mode');
            themeIcon.className = 'fas fa-sun';
          } else {
            themeIcon.className = 'fas fa-moon';
          }
        }

        appState.theme = theme;
        localStorage.setItem('theme', theme);

        // æ›´æ–°ä¸»é¢˜é€‰æ‹©å™¨çŠ¶æ€
        document.querySelectorAll('.theme-selector').forEach(btn => {
          if (btn.dataset.theme === theme) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
      }

      function setupEventListeners() {
        // æ·»åŠ æ–‡ä»¶å¤¹æŒ‰é’®
        document.getElementById('addFolderBtn').addEventListener('click', () => openFolderModal());

        // æ·»åŠ é“¾æ¥æŒ‰é’®
        document.getElementById('addLinkBtn').addEventListener('click', () => openLinkModal(appState.currentFolderId));

        // å¯¼å‡ºæ‰€æœ‰é“¾æ¥æŒ‰é’®ï¼ˆé¡¶éƒ¨å¯¼èˆªæ ï¼‰
        document.getElementById('exportAllBtn').addEventListener('click', openExportModal);

        // åœ¨è®¾ç½®é¢æ¿ä¸­æ‰“å¼€å¯¼å‡ºæ¨¡æ€æ¡†çš„æŒ‰é’®
        document.getElementById('openExportModalBtn').addEventListener('click', function() {
          document.getElementById('settingsModal').classList.remove('active');
          setTimeout(() => openExportModal(), 300);
        });

        // å¯¼å‡ºHTMLæŒ‰é’®
        document.getElementById('exportHtmlBtn').addEventListener('click', exportAsHtml);

        // å¯¼å‡ºJSONæŒ‰é’®
        document.getElementById('exportJsonBtn').addEventListener('click', exportAsJson);

        // å¯¼å‡ºæ–‡æœ¬æŒ‰é’®
        document.getElementById('exportTextBtn').addEventListener('click', exportAsText);

        // å¯¼å‡ºCSVæŒ‰é’®
        document.getElementById('exportCsvBtn').addEventListener('click', exportAsCsv);

        // å¯¼å‡ºå–æ¶ˆæŒ‰é’®
        document.getElementById('exportCancelBtn').addEventListener('click', function() {
          document.getElementById('exportModal').classList.remove('active');
        });

        // æ·»åŠ åˆ°å½“å‰æ–‡ä»¶å¤¹æŒ‰é’®
        document.getElementById('addLinkToCurrentBtn').addEventListener('click', () => {
          openLinkModal(appState.currentFolderId);
        });

        // æ·»åŠ å­æ–‡ä»¶å¤¹æŒ‰é’®
        document.getElementById('addSubfolderBtn').addEventListener('click', () => {
          openFolderModal();
        });

        // è¿”å›æŒ‰é’®
        backBtn.addEventListener('click', function () {
          if (appState.currentFolderId === '') {
            // è¿”å›æ ¹ç›®å½•
            linksContainer.style.display = 'none';
            contentGrid.style.display = 'grid';
            appState.currentFolderId = '';
            backBtn.style.display = 'none';
            renderCurrentView();
          } else {
            // è¿”å›ä¸Šçº§æ–‡ä»¶å¤¹
            const currentFolder = appState.folders.find(f => f.id === appState.currentFolderId);
            if (currentFolder) {
              navigateToFolder(currentFolder.parentId || '');
            }
          }
        });

        // è®¾ç½®æŒ‰é’®
        document.getElementById('settingsBtn').addEventListener('click', () => {
          document.getElementById('settingsModal').classList.add('active');

          // å¡«å……è®¾ç½®è¡¨å•
          document.getElementById('githubToken').value = appState.githubToken;
          document.getElementById('gistId').value = appState.gistId;

          // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
          document.getElementById('tokenStatus').textContent = appState.githubToken ? 'å·²é…ç½®' : 'æœªé…ç½®';
          document.getElementById('currentGistId').textContent = appState.gistId || 'æœªè®¾ç½®';
        });

        // æ–‡ä»¶å¤¹è¡¨å•æäº¤ - ä¿®å¤ï¼šé˜²æ­¢é»˜è®¤æäº¤è¡Œä¸º
        folderForm.addEventListener('submit', function (e) {
          e.preventDefault();

          const name = document.getElementById('folderName').value.trim();
          const description = document.getElementById('folderDescription').value.trim();
          const parentId = document.getElementById('parentFolder').value || '';
          const icon = document.getElementById('folderIcon').value;

          if (!name) {
            showNotification('è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°', 'error');
            return;
          }

          if (appState.editingFolderId) {
            // æ›´æ–°ç°æœ‰æ–‡ä»¶å¤¹
            const folder = appState.folders.find(f => f.id === appState.editingFolderId);
            if (folder) {
              folder.name = name;
              folder.description = description;
              folder.parentId = parentId;
              folder.icon = icon;
              folder.updatedAt = Date.now();
            }
          } else {
            // åˆ›å»ºæ–°æ–‡ä»¶å¤¹
            const newFolder = {
              id: 'folder_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
              name,
              description,
              parentId,
              icon,
              order: appState.folders.filter(f => f.parentId === parentId).length + 1,
              createdAt: Date.now()
            };

            appState.folders.push(newFolder);
          }

          saveData();
          renderCurrentView();
          document.getElementById('folderModal').classList.remove('active');
          showNotification(appState.editingFolderId ? 'æ–‡ä»¶å¤¹å·²æ›´æ–°' : 'æ–‡ä»¶å¤¹å·²åˆ›å»º', 'success');
          appState.editingFolderId = null;
        });

        // é“¾æ¥è¡¨å•æäº¤ - ä¿®å¤ï¼šé˜²æ­¢é»˜è®¤æäº¤è¡Œä¸º
        linkForm.addEventListener('submit', async function (e) {
          e.preventDefault();

          const name = document.getElementById('linkName').value.trim();
          let url = document.getElementById('linkUrl').value.trim();
          const folderId = document.getElementById('linkFolder').value;
          const notes = document.getElementById('linkNotes').value.trim();

          if (!name) {
            showNotification('è¯·è¾“å…¥é“¾æ¥åç§°', 'error');
            return;
          }

          if (!url) {
            showNotification('è¯·è¾“å…¥URL', 'error');
            return;
          }

          // ç¡®ä¿URLæœ‰åè®®å‰ç¼€
          if (!url.startsWith('http://') && !url.startsWith('https://')) {
            url = 'https://' + url;
          }

          // è·å–ç½‘ç«™å›¾æ ‡
          let iconUrl = '';
          try {
            const domain = new URL(url).hostname;
            iconUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;

            // éªŒè¯å›¾æ ‡æ˜¯å¦æœ‰æ•ˆ
            const response = await fetch(iconUrl, { method: 'HEAD' });
            if (!response.ok) {
              iconUrl = '';
            }
          } catch (error) {
            iconUrl = '';
          }

          if (appState.editingLinkId) {
            // æ›´æ–°ç°æœ‰é“¾æ¥
            const link = appState.links.find(l => l.id === appState.editingLinkId);
            if (link) {
              link.name = name;
              link.url = url;
              link.folderId = folderId;
              link.notes = notes;
              link.icon = iconUrl || link.icon;
              link.updatedAt = Date.now();
            }
          } else {
            // åˆ›å»ºæ–°é“¾æ¥
            const newLink = {
              id: 'link_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
              name,
              url,
              folderId,
              notes,
              icon: iconUrl,
              order: appState.links.filter(l => l.folderId === folderId).length + 1,
              createdAt: Date.now()
            };

            appState.links.push(newLink);
          }

          saveData();
          renderCurrentView();
          document.getElementById('linkModal').classList.remove('active');
          showNotification(appState.editingLinkId ? 'é“¾æ¥å·²æ›´æ–°' : 'é“¾æ¥å·²æ·»åŠ ', 'success');
          appState.editingLinkId = null;
        });

        // å›¾æ ‡é€‰æ‹©
        document.querySelectorAll('.folder-icon-option').forEach(option => {
          option.addEventListener('click', function () {
            document.querySelectorAll('.folder-icon-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            document.getElementById('folderIcon').value = this.dataset.icon;
          });
        });

        // ä»¤ç‰Œå¯è§æ€§åˆ‡æ¢
        document.getElementById('toggleTokenVisibility').addEventListener('click', function () {
          const tokenInput = document.getElementById('githubToken');
          const icon = this.querySelector('i');

          if (tokenInput.type === 'password') {
            tokenInput.type = 'text';
            icon.className = 'fas fa-eye-slash';
          } else {
            tokenInput.type = 'password';
            icon.className = 'fas fa-eye';
          }
        });

        // ä¿å­˜è®¾ç½®
        document.getElementById('saveSettingsBtn').addEventListener('click', function () {
          const token = document.getElementById('githubToken').value.trim();
          const gistId = document.getElementById('gistId').value.trim();

          if (!token) {
            showNotification('è¯·è¾“å…¥GitHubä»¤ç‰Œ', 'warning');
            return;
          }

          // éªŒè¯ä»¤ç‰Œæ ¼å¼
          if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
            showNotification('ä»¤ç‰Œæ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä»¥ ghp_ æˆ– github_pat_ å¼€å¤´', 'warning');
            return;
          }

          appState.githubToken = token;
          appState.gistId = gistId;
          localStorage.setItem('githubToken', token);
          if (gistId) {
            localStorage.setItem('gistId', gistId);
          }

          updateLastSyncDisplay();
          showNotification('è®¾ç½®å·²ä¿å­˜', 'success');

          setTimeout(() => {
            document.getElementById('settingsModal').classList.remove('active');
          }, 1000);
        });

        // æµ‹è¯•åŒæ­¥
        document.getElementById('testSyncBtn').addEventListener('click', function () {
          syncWithGist('pull');
        });

        // æ‰‹åŠ¨åŒæ­¥æŒ‰é’®
        document.getElementById('manualSyncBtn').addEventListener('click', function () {
          if (!appState.githubToken) {
            showNotification('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®GitHubä»¤ç‰Œ', 'warning');
            return;
          }
          syncWithGist('pull');
        });

        // å¯¼å‡ºæ•°æ®ä¸ºJSON
        document.getElementById('exportDataBtn').addEventListener('click', function () {
          exportAsJson();
          document.getElementById('settingsModal').classList.remove('active');
        });

        // å¯¼å…¥æ•°æ®
        document.getElementById('importDataBtn').addEventListener('click', function () {
          document.getElementById('importFileInput').click();
        });

        document.getElementById('importFileInput').addEventListener('change', function (e) {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = function (event) {
            try {
              const data = JSON.parse(event.target.result);

              if (confirm('å¯¼å…¥æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                appState.folders = data.folders || [];
                appState.links = data.links || [];
                saveData();
                renderCurrentView();
                showNotification('æ•°æ®å·²å¯¼å…¥', 'success');
              }
            } catch (error) {
              showNotification('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
            }
            e.target.value = '';
          };
          reader.readAsText(file);
        });

        // æ¸…ç©ºæ•°æ®
        document.getElementById('clearDataBtn').addEventListener('click', function () {
          if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
            appState.folders = [];
            appState.links = [];
            saveData();
            renderCurrentView();
            showNotification('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
          }
        });

        // æœç´¢åŠŸèƒ½
        searchInput.addEventListener('input', function () {
          renderCurrentView();
        });

        // ä¸»é¢˜åˆ‡æ¢
        document.getElementById('themeToggle').addEventListener('click', function () {
          let newTheme;
          if (appState.theme === 'light') {
            newTheme = 'dark';
          } else if (appState.theme === 'dark') {
            newTheme = 'auto';
          } else {
            newTheme = 'light';
          }

          setTheme(newTheme);
          showNotification(`å·²åˆ‡æ¢è‡³${newTheme === 'light' ? 'æµ…è‰²' : newTheme === 'dark' ? 'æ·±è‰²' : 'è‡ªåŠ¨'}ä¸»é¢˜`, 'success');
        });

        // ä¸»é¢˜é€‰æ‹©å™¨
        document.querySelectorAll('.theme-selector').forEach(btn => {
          btn.addEventListener('click', function () {
            const theme = this.dataset.theme;
            setTheme(theme);
            showNotification(`å·²åˆ‡æ¢è‡³${theme === 'light' ? 'æµ…è‰²' : theme === 'dark' ? 'æ·±è‰²' : 'è‡ªåŠ¨'}ä¸»é¢˜`, 'success');
          });
        });

        // æ¨¡æ€æ¡†å…³é—­æŒ‰é’®
        document.querySelectorAll('.modal-close').forEach(btn => {
          btn.addEventListener('click', function () {
            this.closest('.modal').classList.remove('active');
          });
        });

        document.getElementById('folderCancelBtn').addEventListener('click', () => {
          document.getElementById('folderModal').classList.remove('active');
          appState.editingFolderId = null;
        });

        document.getElementById('linkCancelBtn').addEventListener('click', () => {
          document.getElementById('linkModal').classList.remove('active');
          appState.editingLinkId = null;
        });

        document.getElementById('exportModalClose').addEventListener('click', () => {
          document.getElementById('exportModal').classList.remove('active');
        });

        document.getElementById('settingsModalClose').addEventListener('click', () => {
          document.getElementById('settingsModal').classList.remove('active');
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.querySelectorAll('.modal').forEach(modal => {
          modal.addEventListener('click', function (e) {
            if (e.target === this) {
              this.classList.remove('active');
              appState.editingFolderId = null;
              appState.editingLinkId = null;
            }
          });
        });

        // ç³»ç»Ÿä¸»é¢˜å˜åŒ–ç›‘å¬
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function (e) {
          if (appState.theme === 'auto') {
            setTheme('auto');
          }
        });

        // æ·»åŠ ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šéšè—æŒ‰é’®æ–‡å­—
        if (window.innerWidth <= 768) {
          document.querySelectorAll('.desktop-only').forEach(el => {
            el.style.display = 'none';
          });
        }

        // çª—å£å¤§å°å˜åŒ–ç›‘å¬
        window.addEventListener('resize', function () {
          if (window.innerWidth <= 768) {
            document.querySelectorAll('.desktop-only').forEach(el => {
              el.style.display = 'none';
            });
          } else {
            document.querySelectorAll('.desktop-only').forEach(el => {
              el.style.display = 'inline';
            });
          }
        });
      }
    });
  </script>
</body>

</html>
